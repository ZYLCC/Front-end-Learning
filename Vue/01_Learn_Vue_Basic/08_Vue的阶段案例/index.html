<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图书购物篮</title>
</head>
<style>
  table { 
    border-collapse: collapse;
    /* text-align: center; */
  }

  thead {
    background-color: #f5f5f5;
  }

  th, td {
    border: 1px solid #aaa;
    padding: 8px 16px;
  }

  .active {
    background-color: skyblue;
  }
</style>
<body>

  <div id="app">
    <template v-if="books.length">
      <table>
        <thead>
          <tr>
            <th>序号</th>
            <th>书籍名称</th>
            <th>出版日期</th>
            <th>价格</th>
            <th>购买数量</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr @click="trClick(index)" 
          :class="{active: index === currentIndex}"
          v-for="(item, index) in books" :key="item.id">
            <td>{{ item.id }}</td>
            <td>{{ item.name }}</td>
            <td>{{ item.date }}</td>
            <td>{{ formatPrice(item.price) }}</td>
            <td >
              <button :disabled="item.count <= 1" @click="minusCount(item)">-</button>
              {{ item.count }}
              <button @click="addCount(item)">+</button>
            </td>
            <td>
              <button @click="delBook(index)">移除</button>
            </td>
          </tr>
        </tbody>
      </table>
      <h2>总价：{{ formatPrice(totalPrice) }}</h2>
    </template>

    <template v-else>
      <h2>当前购物车为空，请选择图书！</h2>
    </template>
    
  </div>
  
  <script src="../lib/vue.js"></script>
  <script src="./data/data.js"></script>  
  <script>
    // 1.创建app
    const app = Vue.createApp({
      // data: option api
      data() {
        return {
          books,
          currentIndex: -1
        }
      },

      computed: {
        totalPrice() {
          return this.books.reduce((preValue, item) => {
            return preValue + item.price * item.count
          }, 0)
        }
      },

      methods: {
        formatPrice(price) {
          return '¥ ' + price
        },
        addCount(item) {
          item.count++
        }, 
        minusCount(item) {
          item.count--
        },
        delBook(index) {
          this.books.splice(index, 1)
        },
        trClick(index) {
          this.currentIndex = index
        }
      }
    })

    // 2.挂载app
    app.mount('#app')
  </script>
</body>
</html>